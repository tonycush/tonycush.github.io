<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link href="https://unpkg.com/tabulator-tables@4.7.2/dist/css/tabulator.min.css" rel="stylesheet">
    <link href="/dist/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.7.2/dist/js/tabulator.min.js"></script>

    <style>
        .comp_output {
            border: solid;
            margin-top: 1em;
        }

        #newDiv {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <h1>Company Demo</h1>
    <h3>INDIVIDUAL INFO</h3>
    <div id="sample" style="background-color: beige;"></div>
    <div id="details"></div>

    <!-- Optional JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>

</body>
<script type="text/javascript">
    fetch("crunchbase_info_sample.json")
        .then(function (response) {
            if (!response.ok) {
                throw new Error("HTTP error, status = " + response.status);
            }
            return response.json();
        })
        .then(function (mydata) {
            console.log("RIGHT - I only want this FILE")

            var searching = window.location.search;
            var this_company_name = searching.substring(1);


            console.log(this_company_name);
            console.log(mydata);
            var this_company_pos = mydata.findIndex((item) => item.name === this_company_name);
            //console.log(this_company_pos)
            console.log(mydata[this_company_pos])

            var ths_comp_out = (JSON.stringify(mydata[this_company_pos]));
            //document.getElementById("demo").innerHTML = ths_comp_out;

            var new_section = document.createElement('div');

            new_section.className = "comp_output";
            new_section.id = "sect_id";
            new_section.innerHTML = "howzatt??";
            document.getElementById("sample").appendChild(new_section);
            //document.getElementById("details").append(Object.assign(document.createElement('div'),{class:"comp_output", id:"newDiv"}));

            console.log("*** *** *** ***");
            var sec_keys = Object.keys(mydata[this_company_pos].sections[0]);
            /*
            console.log(sec_keys)
            for (var j = 0; j < sec_keys.length; j++) {
                entry = sec_keys[j];
                console.log(entry +" : " + typeof(mydata[this_company_pos].sections[0][entry]))
            }
            */
            console.log("*** *** *** ***");
            for (var i = 0; i < mydata[this_company_pos].sections.length; i++) {
                var ori_name = mydata[this_company_pos].sections[i].name;
                var temp_name = ori_name.replace('<!---->', '')
                var updated = temp_name.trim();
                //console.log(ori_name)              
                if (updated != "null") {
                    //console.log(updated);
                    new_section = document.createElement('div');
                    new_section.className = "comp_output";
                    new_section.id = updated;
                    new_section.innerHTML = '<strong>' + updated + '</strong>';
                    document.getElementById("details").appendChild(new_section);

                    for (var j = 0; j < sec_keys.length; j++) {
                        entry = sec_keys[j];
                        //console.log(entry);
                        entry_type = typeof (mydata[this_company_pos].sections[i][entry]);
                        //console.log(entry_type);
                        entry_length = mydata[this_company_pos].sections[i][entry].length;
                        //console.log(entry_length);
                        if (entry_type == 'object' && entry_length > 0) {
                            //console.log("we got us some infoooss");
                            //console.log(updated + " : " + entry + " = " + entry_length);

                            switch (entry) {
                                case 'table':
                                    console.log("--- -- ---- -- - ---");
                                    console.log(updated + " : " + entry + " = " + entry_length);

                                    section_table = document.createElement('table');
                                    section_table.className = "table table-striped";
                                    table_headings = "<strong><thead><tr>";

                                    section_table_info = mydata[this_company_pos].sections[i][entry][0];
                                    console.log(section_table_info)
                                    //console.log(section_table_info.columnNames)
                                    sect_table_len = section_table_info.columnNames.length;
                                    console.log(sect_table_len)
                                    for (var k = 0; k < sect_table_len; k++) {
                                        col_head = section_table_info.columnNames[k].trim();
                                        table_headings += "<th>" + col_head + "</th>"
                                    }
                                    table_headings += "</tr></thead></strong>";


                                    table_body = "<thead>";
                                    console.log(section_table_info.rows)
                                    sect_table_num_rows = section_table_info.rows.length;
                                    for (var k = 0; k < sect_table_num_rows; k++) {
                                        table_body += "<tr>"

                                        row_details = section_table_info.rows[k];

                                        console.log(row_details)
                                        row_split = row_details[0].split(",");
                                        for (var l = 0; l < row_split.length; l++) {
                                            table_body += "<td>" + row_split[l] + "</td>"

                                        }
                                        table_body += "</tr>"
                                    }
                                    table_body += "</thead>";


                                    section_table.innerHTML += table_headings;
                                    section_table.innerHTML += table_body;
                                    document.getElementById(updated).appendChild(section_table);

                                    break;

                                case 'imageCard':
                                    //console.log("IMAGE")
                                    //console.log(image_keys)
                                    //console.log(mydata[this_company_pos].sections[i][entry][0]["rows"][0])
                                    image_count = (mydata[this_company_pos].sections[i][entry][0]["rows"].length)
                                    image_keys = Object.keys(mydata[this_company_pos].sections[i][entry][0]["rows"][0]);
                                    image_table = document.createElement('table');
                                    image_table.className = "table table-striped";
                                    image_table.innerHTML = "<strong><thead><tr><th>logo</th><th>Name</th><th>Info</th></tr></thead></strong>";
                                    image_body = "<tbody>"
                                    for (var k = 0; k < image_count; k++) {

                                        image_body += "<tr>";
                                        for (var l = 0; l < image_keys.length; l++) {
                                            this_image_key = image_keys[l]
                                            image_detail = mydata[this_company_pos].sections[i][entry][0]["rows"][k][this_image_key];
                                            //console.log(this_image_key+ " : " +image_detail)

                                            image_body += "<td>" + image_detail + "</td>";
                                        }

                                        image_body += "</tr>";
                                    }
                                    image_body += "</tbody>";
                                    image_table.innerHTML += image_body;
                                    document.getElementById(updated).appendChild(image_table);
                                    break;
                                default:
                                    //console.log("Standard");
                                    for (var k = 0; k < entry_length; k++) {
                                        this_detail_keys = Object.keys(mydata[this_company_pos].sections[i][entry][k]);
                                        this_detail_values = Object.values(mydata[this_company_pos].sections[i][entry][k]);
                                        //console.log(this_detail_keys + " ::: " + this_detail_values)
                                        section_info = document.createElement('p');
                                        section_info.innerHTML = this_detail_keys + " ::: " + this_detail_values;

                                        document.getElementById(updated).appendChild(section_info);

                                    }
                            }

                            //console.log("--- -- ---- -- - ---");
                        }
                    }

                }
            }

        })
</script>


</html>